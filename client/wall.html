<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/login.css">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Wall</title>
    <style media="screen">
      .margin-top-bottom-50 {
        margin-top: 50px;
        margin-bottom: 50px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <form class="" id="processForm" action="#" method="post">
        <div class="form-group">
          <label for="processed"></label>
          <textarea class="form-control" id="processed" rows="3" placeholder="Share with us your story.."></textarea>
        </div>
        <button type="submit" class="btn btn-default">Process</button>
        <span>Signed in as user: </span><span id="username"></span>
      </form>

      <form class="" id="postForm" action="#" method="post">
        <div class="form-group" id="emotionSpectrums">
        </div>
        <button type="submit" class="btn btn-default">Post</button>
      </form>

      <div class="margin-top-bottom-50" id="postCollection" border="1px solid black">
      </div>

    </div>

    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <!--<script src="http://localhost:3000/socket.io/socket.io.js"></script>-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>-->
    <script type="text/javascript">
      $(function() {
        //let socket = io.connect();

        //GET
        let $username = $('#username')

        axios.get('/wall')
        .then(res => {
          console.log(res);
          $username.html('hay');
        })
        .catch(err => {
          console.log(err);
        })

        // POST
        let $processForm = $('#processForm');
        let $processed = $('#processed');

        let $postForm = $('#postForm');
        let $postReview = $('#postReview');
        let $emotionSpectrums = $('#emotionSpectrums');
        let $post_collection = $('#postCollection');

        $processForm.submit(function(e) {
          e.preventDefault();

          axios.post('http://localhost:3000/nlp', {
            post: $processed.val(),
            username: $username.html()
          })
          .then(res => {
            let sentimentOverallFromKeywordsSum = 0;
            let sentimentOverallFromKeywordsCondition = "";
            let sentimentOverallFromKeywordsConclusion = "Unknown";
            let sentimentEmotionSpectrumFromKeywords = {
              sadness: res.data.keywords[0].emotion.sadness,
              joy: res.data.keywords[0].emotion.joy,
              fear: res.data.keywords[0].emotion.fear,
              disgust: res.data.keywords[0].emotion.disgust,
              anger: res.data.keywords[0].emotion.anger
            }

            console.log(res);
            if(res.data.entities.length != 0) {
              //
            } else {
              res.data.keywords.forEach(key => {
                sentimentOverallFromKeywordsSum += (key.sentiment.score * 100);
              })

              sentimentOverallFromKeywordsSum /= res.data.keywords.length;

              if(sentimentOverallFromKeywordsSum >= 100) sentimentOverallFromKeywordsCondition = `Tremendously Happy`;
              else if(sentimentOverallFromKeywordsSum >= 75) sentimentOverallFromKeywordsCondition = `Very Happy`;
              else if(sentimentOverallFromKeywordsSum >= 50) sentimentOverallFromKeywordsCondition = `Happy`;
              else if(sentimentOverallFromKeywordsSum >= 25) sentimentOverallFromKeywordsCondition = `Probably Happy`;
              else if(sentimentOverallFromKeywordsSum > 0) sentimentOverallFromKeywordsCondition = `Probably a Little Bit Happy`;

              else if(sentimentOverallFromKeywordsSum == 0) sentimentOverallFromKeywordsCondition = `Probably Confused.. Get Some Rest`;

              else if(sentimentOverallFromKeywordsSum <= -100) sentimentOverallFromKeywordsCondition = `Tremendously Sad`;
              else if(sentimentOverallFromKeywordsSum <= -75) sentimentOverallFromKeywordsCondition = `Very Sad`;
              else if(sentimentOverallFromKeywordsSum <= -50) sentimentOverallFromKeywordsCondition = `Sad`;
              else if(sentimentOverallFromKeywordsSum <= -25) sentimentOverallFromKeywordsCondition = `Probably Sad`;
              else if(sentimentOverallFromKeywordsSum < -0) sentimentOverallFromKeywordsCondition = `Probably a Little Bit Sad`;

              sentimentOverallFromKeywordsConclusion = `You're <b>${sentimentOverallFromKeywordsCondition}</b>, with emotion probability of <b>${Math.abs(sentimentOverallFromKeywordsSum)}%</b>`
            }

            console.log(sentimentOverallFromKeywordsSum + "-----------------");
            $post_collection.html(`
              <div>Your Feeling: <br>${sentimentOverallFromKeywordsConclusion}</div>`)
            // console.log(res.data.post);
            // $post_collection.prepend(`
            //   <div>${res.data.post}</div>
            //   <div>posted by ${res.data.username}</div>`)
            //socket.emit('create post', res.data.username, res.data.post);

            $emotionSpectrums.html(
            `
            <label>SADNESS</label>
            <div class="progress">
              <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"
              aria-valuenow="${sentimentEmotionSpectrumFromKeywords.sadness * 100}" aria-valuemin="0" aria-valuemax="100" style="width:${sentimentEmotionSpectrumFromKeywords.sadness * 100}%">
                ${sentimentEmotionSpectrumFromKeywords.sadness * 100}%
              </div>
            </div>

            <label>JOY</label>
            <div class="progress">
              <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"
              aria-valuenow="${sentimentEmotionSpectrumFromKeywords.joy * 100}" aria-valuemin="0" aria-valuemax="100" style="width:${sentimentEmotionSpectrumFromKeywords.joy * 100}%">
                ${sentimentEmotionSpectrumFromKeywords.joy * 100}%
              </div>
            </div>

            <label>FEAR</label>
            <div class="progress">
              <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"
              aria-valuenow="${sentimentEmotionSpectrumFromKeywords.fear * 100}" aria-valuemin="0" aria-valuemax="100" style="width:${sentimentEmotionSpectrumFromKeywords.fear * 100}%">
                ${sentimentEmotionSpectrumFromKeywords.fear * 100}%
              </div>
            </div>

            <label>DISGUST</label>
            <div class="progress">
              <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"
              aria-valuenow="${sentimentEmotionSpectrumFromKeywords.disgust * 100}" aria-valuemin="0" aria-valuemax="100" style="width:${sentimentEmotionSpectrumFromKeywords.disgust * 100}%">
                ${sentimentEmotionSpectrumFromKeywords.disgust * 100}%
              </div>
            </div>

            <label>ANGER</label>
            <div class="progress">
              <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"
              aria-valuenow="${sentimentEmotionSpectrumFromKeywords.anger * 100}" aria-valuemin="0" aria-valuemax="100" style="width:${sentimentEmotionSpectrumFromKeywords.anger * 100}%">
                ${sentimentEmotionSpectrumFromKeywords.anger * 100}%
              </div>
            </div>
            `);

            $postForm.submit(function(e) {
              e.preventDefault();

              let highestEmotionSpectrumFromKeywords = [];
              for (var key in sentimentEmotionSpectrumFromKeywords) {
                highestEmotionSpectrumFromKeywords.push([key, sentimentEmotionSpectrumFromKeywords[key]]);
              }
              highestEmotionSpectrumFromKeywords.sort(function(a, b) {
                return b[1] - a[1];
              })
              console.log(`${highestEmotionSpectrumFromKeywords[0][0]}: ${highestEmotionSpectrumFromKeywords[0][1]}`);

              axios.post('http://localhost:3000/youtube', {
                highest_emotion_from_keywords: [highestEmotionSpectrumFromKeywords[0][0], highestEmotionSpectrumFromKeywords[0][1]]
              })
              .then()
              .catch();
            })
          })
          .catch(err => {
            console.log(err);
          })
        })

        // socket.on('new post', (data) => {
        //   $post_collection.prepend(`
        //     <div>${data.post}</div>
        //     <div>posted by ${data.username}</div>`)
        // })

      })
    </script>
  </body>
</html>
